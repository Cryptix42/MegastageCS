; *************************
; Project: MegastageCS
; File: Math.lib.dasm
; *************************

;Param A, and B. Takes a hexadecimal number at A and returns to address B, the decimal equivalent in the form of a string.
;A slight modification of StillNoNumber's code (http://www.0x10cforum.com/profile/2236555 _also known as NaNDummy)
:convert_from_hex_16 ;(takes A as UInt, returns cth/n/ while each of them is a number between 0 and 9 and cth1 is the last digit) 
set push, ex
;preparation 
SET [B+4], A 
SET [B+3], A 
SET [B+2], A 
SET [B+1], A 
SET [B], A 
;last digit 
MOD [B+4], 10 
;fourth digit 
DIV [B+3], 10 
MOD [B+3], 10 
;third digit 
DIV [B+2], 100 
MOD [B+2], 10 
;second digit 
DIV [B+1], 1000 
MOD [B+1], 10 
;first digit 
DIV [B], 10000 
MOD [B], 10 
;ASCII processer
bor [B+4], 0x0030
bor [B+3], 0x0030
bor [B+2], 0x0030
bor [B+1], 0x0030
bor [B], 0x0030
set ex, pop
set pc, pop

:convert_from_hex_32 ;b and c are the UInt32s, I - I+9 the decimal digits, starting from the last digit
;B, C, X, Y, Z and I will be modified
;Main work done by orlof http://www.0x10cforum.com/profile/2364954, some work by StillNoNumber http://www.0x10cforum.com/profile/2236555
;Debugged by Cryptix http://www.0x10cforum.com/profile/2423132 and orlof
;Untested

SET [lalalalalalauselesslabeldonteverusethiswhytheheckamigivingthissuchalongnamehopeitsnotusedanywherebeforenevermindletsstartwiththecodeanotheruselesslabel], I
ADD [lalalalalalauselesslabeldonteverusethiswhytheheckamigivingthissuchalongnamehopeitsnotusedanywherebeforenevermindletsstartwiththecodeanotheruselesslabel], 10

:lalalalalalauselesslabeldonteverusethiswhytheheckamigivingthissuchalongnamehopeitsnotusedanywherebeforenevermindletsstartwiththecode
SET X, B
SET Y, C
MOD X, 10
MOD Y, 10
MUL Y, 6
SET Z, X
ADD Z, B
MOD Z, 10
JSR divu10 
ADD I, 1 ;might make STI in the future here
IFN [lalalalalalauselesslabeldonteverusethiswhytheheckamigivingthissuchalongnamehopeitsnotusedanywherebeforenevermindletsstartwiththecodeanotheruselesslabel], I
SET PC, lalalalalalauselesslabeldonteverusethiswhytheheckamigivingthissuchalongnamehopeitsnotusedanywherebeforenevermindletsstartwiththecode
SET PC, POP

:lalalalalalauselesslabeldonteverusethiswhytheheckamigivingthissuchalongnamehopeitsnotusedanywherebeforenevermindletsstartwiththecodeanotheruselesslabel
DAT 0

;----------------------------------------------------------------
:divu10
;  b:c divident
; return
;  a   remainder
;  b:c quotient
;----------------------------------------------------------------
set push, x

set x, 0
set a, 0

:divu10_loop
add x, 1
ife x, 32
  set pc, divu10_exit

shl a, 1
shl b, 1
bor a, ex
shl c, 1
bor b, ex

ifl a, 10
  set pc, divu10_loop

sub a, 10
bor c, 1

set pc, divu10_loop

:divu10_exit
set x, pop
set pc, pop
